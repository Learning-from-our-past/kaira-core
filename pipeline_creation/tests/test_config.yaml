book_series: Siirtokarjalaisten tie
pipeline:
  - !Extractor &PrimaryPersonName {
      module: "book_extractors.karelians.extraction.extractors.name_extractor",
      class_name: "NameExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.image_extractor",
      class_name: "ImageExtractor"
    }

  - !Extractor &FormerSurname {
      module: "book_extractors.karelians.extraction.extractors.original_family_extractor",
      class_name: "FormerSurnameExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.profession_extractor",
      class_name: "ProfessionExtractor",
      cursor_location_depend_on: *FormerSurname,
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor &Birthday {
      module: "book_extractors.karelians.extraction.extractors.birthday_extractor",
      class_name: "BirthdayExtractor",
      cursor_location_depend_on: *FormerSurname,
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.location_extractor",
      class_name: "BirthdayLocationExtractor",
      cursor_location_depend_on: *Birthday,
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.common.extractors.previous_marriages_flag_extractor",
      class_name: "PreviousMarriagesFlagExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.war_data_extractor",
      class_name: "WarDataExtractor",
      options: {
        output_path: "primaryPerson"
      },
      pipeline: [
        !Extractor {
          module: "book_extractors.karelians.extraction.extractors.injured_in_war_flag_extractor",
          class_name: "InjuredInWarFlagExtractor",
          depends_on: [ *PrimaryPersonName ],
          options: {
            in_spouse_extractor: false
          }
        },
        !Extractor {
          module: "book_extractors.karelians.extraction.extractors.served_during_war_flag_extractor",
          class_name: "ServedDuringWarFlagExtractor",
          depends_on: [ *PrimaryPersonName ],
          options: {
            in_spouse_extractor: false
          }
        },
        !Extractor {
          module: "book_extractors.karelians.extraction.extractors.lotta_activity_flag_extractor",
          class_name: "LottaActivityFlagExtractor",
          depends_on: [ *PrimaryPersonName ],
          options: {
            in_spouse_extractor: false
          }
        },
      ]
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.migration_route_extractors",
      class_name: "MigrationRouteExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.omakotitalo_extractor",
      class_name: "OmakotitaloExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.spouse_extractor",
      class_name: "SpouseExtractor"
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.child_extractor",
      class_name: "ChildExtractor"
    }

  - !Extractor {
      module: "book_extractors.karelians.extraction.extractors.farm_extractor",
      class_name: "FarmDetailsExtractor",
      pipeline: [
        !Extractor {
            module: "book_extractors.common.extractors.bool_extractor",
            class_name: "BoolExtractor",
            options: {
              # Regex patterns for different farm flags. Take care to use single quotes ' so that
              # regex patterns really work. This is because of how PyYaml handles strings:
              # https://pyyaml.org/wiki/PyYAMLDocumentation  (Scalars section)
              patterns: {
                animalHusbandry: 'karjataloutta|karjanhoitoa?\b|karjatalous\b',
                dairyFarm: 'lypsy-|lypsy\b|lypsykarja(?!sta)',
                asutustila: '(?:asutustila){s<=1,i<=1}|(?:pika-asutustila){s<=1,i<=1}',
                maanhankintalaki: '(?:maanhankinta){s<=1,i<=1}',
                coldFarm: 'kylmÃ¤t'
              }
            }
        },
        !Extractor {
          module: "book_extractors.karelians.extraction.extractors.farm_area_extractor",
          class_name: "FarmAreaExtractor"
        }
      ]
    }

  - !Extractor {
      module: "book_extractors.common.extractors.kaira_id_extractor",
      class_name: "KairaIdExtractor",
      options: {
        output_path: "primaryPerson"
      }
    }
